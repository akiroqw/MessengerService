<Page x:Class="Client.Views.Pages.HomeView"
      xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
      xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
      xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
      xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
      xmlns:local="clr-namespace:Client.Views.Pages"
      xmlns:iconPacks="http://metro.mahapps.com/winfx/xaml/iconpacks"
      xmlns:loadingSpinnerControl="clr-namespace:LoadingSpinnerControl;assembly=LoadingSpinnerControl"
      xmlns:modalControl="clr-namespace:ModalControl;assembly=ModalControl"
      xmlns:customControls="clr-namespace:Client.CustomControls"
      mc:Ignorable="d"
      d:DesignHeight="630" 
      d:DesignWidth="1100">


    <Grid>
      
        <Grid>

            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="300"/>
                <ColumnDefinition />
            </Grid.ColumnDefinitions>

            <Grid   x:Name="MainGrid"
                Background="{StaticResource UsersListBackgroundColorBrush}" 
                Grid.Column="0">

                <Grid.RowDefinitions>
                    <RowDefinition Height="70"/>
                    <RowDefinition />
                </Grid.RowDefinitions>

                <Grid Grid.Row="0">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="50"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>

                    <ToggleButton
                            Grid.Column="0"
                            Style="{StaticResource ToggleButtonStyle}">
                        <ToggleButton.Triggers>
                            <EventTrigger RoutedEvent="ToggleButton.Unchecked">
                                <BeginStoryboard>
                                    <Storyboard x:Name="HideStackPanel">
                                        <DoubleAnimation Storyboard.TargetName="Menu" Storyboard.TargetProperty="Width" BeginTime="0:0:0" From="250" To="0" Duration="0:0:0.2">
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                            <EventTrigger RoutedEvent="ToggleButton.Checked">
                                <BeginStoryboard>
                                    <Storyboard x:Name="ShowStackPanel">
                                        <DoubleAnimation Storyboard.TargetName="Menu" Storyboard.TargetProperty="Width" BeginTime="0:0:0" From="0" To="250" Duration="0:0:0.2">
                                        </DoubleAnimation>
                                    </Storyboard>
                                </BeginStoryboard>
                            </EventTrigger>
                        </ToggleButton.Triggers>
                    </ToggleButton>

                    <TextBox Width="220"
                             Height="38"
                             Grid.Column="1"
                             HorizontalAlignment="Center"
                             VerticalAlignment="Center"
                             Background="#313131"
                             BorderThickness="0"
                             Text="{Binding SearchText, 
                    UpdateSourceTrigger=PropertyChanged}"
                             Tag="Search"/>
                </Grid>

                <ListView Background="Transparent"
                         x:Name="UsersListView"
                         BorderThickness="0"
                         SelectedItem="{Binding SelectedUser}"
                         ItemsSource="{Binding Contacts}"
                         Grid.Row="1">

                    <ListView.ItemContainerStyle>
                        <Style TargetType="ListViewItem">
                            <Setter Property="HorizontalContentAlignment" Value="Stretch"/>
                        </Style>
                    </ListView.ItemContainerStyle>

                    <ListView.ItemTemplate>
                        <DataTemplate>
                            <Border Background="Transparent"
                                Height="65">
                                <Grid>
                                    <StackPanel Orientation="Horizontal"
                                                Height="Auto"
                                                Margin="15, 0, 0, 0">

                                        <Border Width="40"  Height="40" CornerRadius="25" Background="White"/>

                                        <StackPanel Margin="5, 5, 0, 0">
                                            <Label Content="{Binding UserName}" 
                                               Foreground="White"   
                                               FontSize="13"/>
                                            <Label Content="Last Message" 
                                                   Foreground="White"   
                                                   FontSize="13"/>
                                        </StackPanel>
                                    </StackPanel>
                                </Grid>
                            </Border>
                        </DataTemplate>
                    </ListView.ItemTemplate>
                </ListView>
            </Grid>

            <loadingSpinnerControl:LoadingSpinner
                Grid.Column="1" 
                IsLoading="{Binding IsLoading}"/>

            <Border Grid.Column="1"
                Width="210"
                Background="{StaticResource ColorWrapBrush}"
                CornerRadius="17"
                Height="32"
                Visibility="{Binding IsSelectedUser, 
                            Converter={StaticResource InverseBooleanToVisibilityConverter}}">

                <TextBlock
                       VerticalAlignment="Center"
                       HorizontalAlignment="Center"
                       Text="Select a chat to start messaging"
                       Style="{StaticResource DefaultTextBlockStyle}"/>
            </Border>

            <Frame Grid.Column="1" Content="{Binding ChatViewModel}"/>

        </Grid>

        <Border  x:Name="Menu"
                 Grid.Column="0"
                 Width="250"
                 CornerRadius="0, 0, 0, 10"
                 HorizontalAlignment="Left"
                 Background="{StaticResource MenuBackgroundColorColorBrush}" >

            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="150"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>



                <StackPanel Grid.Row="1" VerticalAlignment="Top">
                    <Button x:Name="BtnSettings" Style="{DynamicResource PopupButtonStyle}">
                        <customControls:MenuItem
                            GroupName="MenuItem"
                            IconWidth="18"
                            Text="Settings"
                            Icon="{StaticResource Settings}"
                            HorizontalAlignment="Center"
                            IndicatorBrush="{StaticResource ButtonColorBrush}"/>
                    </Button>
                </StackPanel>
            </Grid>
        </Border>

    </Grid>





</Page>
